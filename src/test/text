
import { initializeApp } from 'firebase/app';
import './style.scss'
import {
  getDatabase,
  set,
  ref,
  push,
  child,
  onValue,
  onChildAdded
} from "firebase/database";

const firebaseConfig = {
    apiKey: "AIzaSyAbrSlPJqm6a0sdSm-f4Ds7MWrIpoyIF-s",
    authDomain: "clone-instagram-7c300.firebaseapp.com",
    databaseURL: "https://clone-instagram-7c300-default-rtdb.firebaseio.com",
    projectId: "clone-instagram-7c300",
    storageBucket: "clone-instagram-7c300.appspot.com",
    messagingSenderId: "572673925162",
    appId: "1:572673925162:web:c129d35a8ea48e1ce9a353"
  };

const app = initializeApp(firebaseConfig);
const database = getDatabase(app);

let recipient = 'vika'
let myName = 'kira';



const placeMessage = document.querySelector('.place-for-message');
const html = document.querySelector('html')
html.addEventListener('keypress', (e) => {
  if(e.key === 'Enter'){
    const message = document.getElementById('message').value;
        const id = push(child(ref(database), 'messages')).key;
        set(ref(database, `messages/${sortName(myName, recipient)}/` + id), {
            name: myName,
            message: message
        });
        document.getElementById('message').value = "";
  }
} )
const submit = document.querySelector('.submit')
submit.addEventListener('click' , () => {
});

    submit.addEventListener('click', (e) => {
      const message = document.getElementById('message').value;

      

        const id = push(child(ref(database), 'messages')).key;
        set(ref(database, `messages/${sortName(myName, recipient)}/` + id), {
            name: myName,
            message: message
        });
        document.getElementById('message').value = "";
    });

    const newMsg = ref(database, `messages/${sortName(myName, recipient)}/`);

    onChildAdded(newMsg, (data) => {
        if(data.val().name != myName) {
            const divData = `
            <div class="interlocutor">
            <img  src="https://static.turbosquid.com/Preview/001292/481/WV/_D.jpg" alt="userPhoto">
            <span>${data.val().message}</span>
            </div>
            `;
            placeMessage.insertAdjacentHTML('beforeend', divData);
        }else{
            const divData = `
            <div class="you-message">
            <span>${data.val().message}</span>
            </div>
            `;
              placeMessage.insertAdjacentHTML('beforeend', divData);
        }
    });
    function sortName (name1, name2) {
      return [name1, name2].sort().join('');
    }
